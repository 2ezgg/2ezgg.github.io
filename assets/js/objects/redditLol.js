function RedditLol(){this.youtubeVids=[],this.redditThreads=[],this.currentRedditSettings=[null,"leagueoflegends","hot",null],this.currentYoutubeSettings=[null,"leagueoflegends","hot",null],this.youtubeCount=0,this.redditCount=0,this.nextPageReddit,this.nextPageYoutube,this.previousYoutubeLength=0,this.previousRedditLength=0,this.redditAjaxRequest}RedditLol.prototype.getAbout=function(){var a=$.Deferred(),b=this;return b.redditAjaxRequest=$.ajax({dataType:"json",url:"http://www.reddit.com/r/leagueoflegends/about.json?jsonp=",error:function(){console.log("Unable to load reddit about api")},success:function(b){var c=b.data.description_html;$side=$(".side"),$side.html(c),$side.html($side.text());var c=$side.html();localStorage.setItem("aboutHtml",c),localStorage.setItem("lastRedditAboutRetrieval",Date.now()),a.resolve()}}),a.promise()},RedditLol.prototype.displayAbout=function(){var a=localStorage.getItem("lastRedditAboutRetrieval");null==a||parseInt(a)+36e5<=Date.now()?this.getAbout():$(".side").html(localStorage.getItem("aboutHtml"))},RedditLol.prototype.getThreads=function(a,b,c,d,e){var f=a,g="";b&&c&&d&&e?g="http://www.reddit.com/r/"+b+"/"+c+".json?limit=50&t="+d+"&after="+e+"&jsonp=":b&&c&&d?g="http://www.reddit.com/r/"+b+"/"+c+".json?limit=50&t="+d+"&jsonp=":b&&c&&e?g="http://www.reddit.com/r/"+b+"/"+c+".json?limit=50&after="+e+"&jsonp=":b&&c&&(g="http://www.reddit.com/r/"+b+"/"+c+".json?limit=50&jsonp=");var h=$.Deferred(),i=this;return i.redditAjaxRequest=$.ajax({dataType:"json",url:g,error:function(){console.log("Unable to load reddit api")},success:function(a){var b=a.data.children,c=0;"youtube"==f?i.previousYoutubeLength=i.youtubeVids.length:"reddit"==f&&(i.previousRedditLength=i.redditThreads.length);for(var d=0;d<b.length;d++){var e="",g=b[d].data.domain;b[d].data.selftext_html&&(e=b[d].data.selftext_html,e=e.replace(/href=\"\/u\//gi,'href="http://reddit.com/u/'),e=e.replace(/href=\"\/r\//gi,'href="http://reddit.com/r/')),null==f?(localStorage.setItem("redditLastRetrieved",Date.now()),localStorage.setItem("youtubeLastRetrieved",Date.now()),i.redditThreads[d]={domain:b[d].data.domain,title:b[d].data.title,url:b[d].data.url,score:b[d].data.score,commentsTotal:b[d].data.num_comments,permalink:b[d].data.permalink,created:b[d].data.created_utc,content:e,author:b[d].data.author,thumbnail:b[d].data.thumbnail,redditRank:d+1+i.previousRedditLength,linkFlair:b[d].data.link_flair_css_class,authorFlair:b[d].data.author_flair_css_class,videoEmbed:null,after:a.data.after},"youtube.com"!=g&&"youtu.be"!=g||b[d].data.url.match(/user/i)||null==b[d].data.media||"undefined"==typeof b[d].data.media.oembed.url||(i.youtubeVids[c]={title:b[d].data.title,url:b[d].data.media.oembed.url,videoEmbed:b[d].data.media.oembed.url.replace(/watch\?v=/i,"embed/"),score:b[d].data.score,created:b[d].data.created_utc,author:b[d].data.author,commentsTotal:b[d].data.num_comments,permalink:b[d].data.permalink,redditRank:d+1,videoRank:c+1,after:a.data.after},c++,i.redditThreads[d].videoEmbed=b[d].data.media.oembed.url.replace(/watch\?v=/i,"embed/")),i.nextPageYoutube=a.data.after,i.nextPageReddit=a.data.after):"youtube"==f?(localStorage.setItem("youtubeLastRetrieved",Date.now()),"youtube.com"!=g&&"youtu.be"!=g||b[d].data.url.match(/user/i)||null==b[d].data.media||"undefined"==typeof b[d].data.media.oembed.url||(i.youtubeVids[c+i.previousYoutubeLength]={title:b[d].data.title,url:b[d].data.media.oembed.url,videoEmbed:b[d].data.media.oembed.url.replace(/watch\?v=/i,"embed/"),score:b[d].data.score,created:b[d].data.created_utc,author:b[d].data.author,commentsTotal:b[d].data.num_comments,permalink:b[d].data.permalink,redditRank:d+1,videoRank:c+i.previousYoutubeLength+1,after:a.data.after},c++),i.nextPageYoutube=a.data.after):"reddit"==f&&(localStorage.setItem("redditLastRetrieved",Date.now()),i.redditThreads[d+i.previousRedditLength]={domain:b[d].data.domain,title:b[d].data.title,url:b[d].data.url,score:b[d].data.score,commentsTotal:b[d].data.num_comments,permalink:b[d].data.permalink,created:b[d].data.created_utc,content:e,author:b[d].data.author,thumbnail:b[d].data.thumbnail,redditRank:d+1+i.previousRedditLength,linkFlair:b[d].data.link_flair_css_class,authorFlair:b[d].data.author_flair_css_class,videoEmbed:null,after:a.data.after},"youtube.com"!=g&&"youtu.be"!=g||b[d].data.url.match(/user/i)||null==b[d].data.media||"undefined"==typeof b[d].data.media.oembed.url||(i.redditThreads[d+i.previousRedditLength].videoEmbed=b[d].data.media.oembed.url.replace(/watch\?v=/i,"embed/")),i.nextPageReddit=a.data.after)}if("youtube"!=f)for(var j=0;j<i.redditThreads.length;j++)("self"==i.redditThreads[j].thumbnail||"default"==i.redditThreads[j].thumbnail)&&(i.redditThreads[j].thumbnail="assets/img/default.png");localStorage.setItem("redditThreads",JSON.stringify(i.redditThreads)),localStorage.setItem("nextPage",i.nextPageReddit),localStorage.setItem("redditSettings",JSON.stringify(i.currentRedditSettings)),h.resolve()}}),h.promise()},RedditLol.prototype.youtubeArea=function(){var a=this,b=Handlebars.compile($("#youtube-template").html());0==a.youtubeVids.length&&$("#reddit-progress").html("<p>Sorry all out of reddit threads for now</p>");for(var c=0;4>c;c++)a.youtubeVids.length>a.youtubeCount&&($("#youtube-threads").append(b(a.youtubeVids[a.youtubeCount])),a.youtubeCount++)},RedditLol.prototype.mainPage=function(a){var b=this,c=Handlebars.compile($("#reddit-template").html());b.redditThreads.length<25&&$("#reddit-progress").html("<p>Sorry all out of reddit threads for now</p>");var d=25;a&&(d=b.redditThreads.length);for(var e=0;d>e;e++)if(b.redditThreads.length>b.redditCount){$("#reddit-threads").append(c(b.redditThreads[b.redditCount]));var f=$(".reddit-expand").eq(b.redditCount).children(".decode");f.html(f.text()),b.redditCount++}};